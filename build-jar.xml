<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project default="all" basedir=".">

	<!-- - - - - - - - - - - - - - Properties - - - - - - - - - - - - - - - -->

	<!-- Eclipse-Konfiguration wiederverwenden -->
	<property file="META-INF/MANIFEST.MF" />
	<property name="jar.file" value="${Bundle-SymbolicName}.jar" />

	<property name="mainclass" value="" />
	<property name="license.file" value="LGPL_2.1.txt" />
	<property name="src.version" value="1.5" />
	<property name="src.dir" location="src" />
	<property name="tmp.dir" location="tmp" />

	<path id="build.classpath">
		<fileset dir="${eclipse.home}/plugins">
			<include name="org.apache.commons.codec_1.3.0*.jar" />
		</fileset>
		<fileset dir="${basedir}/../com.bitctrl">
			<include name="com.bitctrl.jar" />
		</fileset>
		<fileset dir="${basedir}/../de.bsvrz.dav.daf.plus.funclibErweiterung/distributionspakete/de.bsvrz.dav.daf">
			<include name="de.bsvrz.dav.daf-runtime.jar" />
		</fileset>
		<fileset dir="${basedir}/../de.bsvrz.sys.funclib.application/distributionspakete/de.bsvrz.sys.funclib.application">
			<include name="de.bsvrz.sys.funclib.application-runtime.jar" />
		</fileset>
		<fileset dir="${basedir}/../de.bsvrz.sys.funclib.commandLineArgs/distributionspakete/de.bsvrz.sys.funclib.commandLineArgs">
			<include name="de.bsvrz.sys.funclib.commandLineArgs-runtime.jar" />
		</fileset>
		<fileset dir="${basedir}/../de.bsvrz.sys.funclib.debug/distributionspakete/de.bsvrz.sys.funclib.debug">
			<include name="de.bsvrz.sys.funclib.debug-runtime.jar" />
		</fileset>
			<fileset dir="${basedir}/../de.bsvrz.sys.funclib.operatingMessage/distributionspakete/de.bsvrz.sys.funclib.operatingMessage">
				<include name="de.bsvrz.sys.funclib.operatingMessage-runtime.jar" />
			</fileset>
	</path>

	<!-- - - - - - - - - - - - - - - Targets - - - - - - - - - - - - - - - - -->

	<target name="all" description="Alles erstellen und anschließend aufräumen">
		<antcall target="release.jar" />
		<antcall target="release.javadoc.api" />
		<antcall target="clean" />
	</target>

	<target name="prepare" description="Leistet notwendige Vorarbeiten" depends="clean">
		<mkdir dir="${tmp.dir}" />
	</target>

	<target name="clean" description="Temporäre Dateien entfernen">
		<delete dir="${tmp.dir}" />
	</target>

	<target name="release.jar" description="Erstellt das jar-File aus den Quellen" depends="prepare">
		<mkdir dir="${tmp.dir}/bin" />
		<javac debug="on" debuglevel="lines,vars,source" destdir="${tmp.dir}/bin" target="${src.version}" deprecation="on">
			<classpath refid="build.classpath" />
			<src path="${src.dir}" />
			<compilerarg value="-Xlint:unchecked" />
		</javac>
		<tstamp />
		<copy todir="${tmp.dir}/bin">
			<fileset dir="${basedir}">
				<filename name="${license.file}" />
			</fileset>
			<fileset dir="${src.dir}">
				<exclude name="**/*.java" />
			</fileset>
		</copy>
		<jar basedir="${tmp.dir}/bin" compress="yes" destfile="${jar.file}" excludes="**/package-info.class" index="yes">
			<manifest>
				<attribute name="Implementation-Title" value="${Bundle-Name}" />
				<attribute name="Implementation-Version" value="${Bundle-Version} (${DSTAMP}-${TSTAMP})" />
				<attribute name="Implementation-Vendor" value="${Bundle-Vendor}" />
				<attribute name="Implementation-URL" value="http://www.bitctrl.de" />
				<attribute name="Main-Class" value="${mainclass}" />
			</manifest>
		</jar>
	</target>

	<target name="release.javadoc.api" description="API-Dokumentation erstellen">
		<delete dir="doc/api" />
		<javadoc overview="${src.dir}/overview.html" additionalparam="-tag todo:a:&quot;To Do:&quot;" access="protected" author="true" classpathref="build.classpath" destdir="doc/api" doctitle="API-Dokumentation für ${Bundle-SymbolicName}" nodeprecated="false" nodeprecatedlist="false" noindex="false" nonavbar="false" notree="false" packagenames="de.bsvrz.sys.funclib.bitctrl.*" source="${src.version}" sourcepath="${src.dir}" splitindex="true" use="true" version="true" link="http://java.sun.com/j2se/${src.version}.0/docs/api/" />
	</target>

</project>
